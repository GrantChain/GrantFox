generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  user_id         String          @id @default(cuid())
  email           String          @unique
  wallet_address  String?         @unique
  role            UserRole
  username        String?         @unique
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt
  profile_url     String?
  cover_url       String?
  location        String?
  bio             String?
  is_active       Boolean         @default(true)
  grantee         Grantee?
  payouts         Payout[]        @relation("PayoutsCreatedBy")
  payout_provider PayoutProvider?
  system_logs     SystemLog[]

  @@index([role])
  @@index([is_active])
  @@index([created_at])
  @@index([role, is_active])
  @@map("user")
}

model PayoutProvider {
  user_id           String   @id @default(cuid())
  organization_name String?
  network_type      String?
  email             String?
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt
  user              User     @relation(fields: [user_id], references: [user_id])

  @@index([network_type])
  @@index([created_at])
  @@map("payout_provider")
}

model Grantee {
  user_id        String   @id @default(cuid())
  name           String?
  position_title String?
  social_media   Json?
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt
  user           User     @relation(fields: [user_id], references: [user_id])
  payouts        Payout[]

  @@index([name])
  @@index([created_at])
  @@map("grantee")
}

model Payout {
  payout_id     String       @id @default(cuid())
  title         String
  description   String
  status        PayoutStatus
  total_funding Decimal
  currency      Currency
  created_by    String
  created_at    DateTime     @default(now())
  updated_at    DateTime     @updatedAt
  grantee_id    String?
  image_url     String?
  type          PayoutType
  milestones    Json?
  escrow_id     String?
  user          User         @relation("PayoutsCreatedBy", fields: [created_by], references: [user_id])
  grantee       Grantee?     @relation(fields: [grantee_id], references: [user_id])

  @@index([created_by])
  @@index([grantee_id])
  @@index([status])
  @@index([currency])
  @@index([created_at])
  @@index([status, created_at])
  @@index([created_by, status])
  @@map("payout")
}

model SystemLog {
  log_id      String    @id @default(cuid())
  user_id     String?
  log_type    LogType
  action      String
  entity_type String?
  entity_id   String?
  description String
  ip_address  String?
  browser     String?
  os          String?
  status      LogStatus @default(INFO)
  created_at  DateTime  @default(now())
  user        User?     @relation(fields: [user_id], references: [user_id])

  @@index([user_id])
  @@index([log_type])
  @@index([entity_type, entity_id])
  @@index([created_at])
  @@index([status])
  @@map("system_log")
}

model Waitlist {
  id         BigInt   @id @default(autoincrement())
  created_at DateTime @default(now()) @db.Timestamptz(6)
  email      String?
  phone      String?
  full_name  String?

  @@map("waitlist")
  @@ignore
}

enum UserRole {
  GRANTEE
  PAYOUT_PROVIDER
  EMPTY
  ADMIN
}

enum PayoutStatus {
  DRAFT
  PUBLISHED
  CLOSED
  CANCELED
}

enum Currency {
  USDC
  XLM
  EURC
}

enum PayoutType {
  GRANT
  BOUNTY
  HACKATHON
}

enum MilestoneStatus {
  PENDING
  SUBMITTED
  APPROVED
  REJECTED
}

enum LogType {
  ACTIVITY
  ERROR
  SECURITY
  TRANSACTION
}

enum LogStatus {
  INFO
  WARNING
  ERROR
  CRITICAL
}
